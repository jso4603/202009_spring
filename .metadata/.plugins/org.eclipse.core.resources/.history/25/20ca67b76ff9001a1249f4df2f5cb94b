package org.spring.service;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLEncoder;
import java.util.Map;

import org.apache.tomcat.util.json.JSONParser;
import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.springframework.stereotype.Service;

import com.fasterxml.jackson.databind.jsonFormatVisitors.JsonObjectFormatVisitor;

@Service
public class MapService {

	public Map<String, Double> getGeocoding(String address) throws IOException {

		System.out.println("getGeocoding:" + address);
		address = URLEncoder.encode(address, "utf-8");
		//Geocodding api 호출
		String api  = "https://naveropenapi.apigw.ntruss.com/map-geocode/v2/geocode?query="+address;
		URL url = new URL(api);
		HttpURLConnection http =  (HttpURLConnection) url.openConnection();
		http.setRequestProperty("Content-Type", "application/json");
		http.setRequestProperty("X-NCP-APIGW-API-KEY-ID", "bu893hnprh");
		http.setRequestProperty("X-NCP-APIGW-API-KEY", "BJjdndJE0aWWVhYBOMoYy3pBAFyXmngtE1c1vhxg");
		http.setRequestMethod("GET");
		http.connect();
		BufferedReader br =
				new BufferedReader(new InputStreamReader(http.getInputStream(), "utf-8"));
		
		String rdData;
		while ((rdData = br.readLine()) != null) {
			System.out.println(rdData);
			JSONObject object = (JSONObject)new JSONParser().parse(rdData);
			JSONArray array = (JSONArray)object.get("addresses"); //가져온 값이 배열
			for(int i = 0 ;i < array.size(); i++) {
				object = (JSONObject)array.get(i);
				System.out.println(object);
			}
			
		}
//		-H "X-NCP-APIGW-API-KEY-ID: {애플리케이션 등록 시 발급받은 client id값}" \
//		-H "X-NCP-APIGW-API-KEY: {애플리케이션 등록 시 발급받은 client secret값}" -v

		return null;
	}

}
